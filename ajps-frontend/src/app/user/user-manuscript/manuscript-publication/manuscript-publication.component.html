<div class="row" *ngIf="manuscript">
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-journal-check me-2"></i>Article Details
                </h5>
                <div class="d-flex align-items-center">
                    <label for="publicationStatusSelect" class="form-label text-white me-2 mb-0">Status:</label>
                    <select id="publicationStatusSelect" class="form-select form-select-sm" [(ngModel)]="manuscript.publicationStatus">
                        <option value="Draft">Draft</option>
                        <option value="Scheduled">Scheduled</option>
                        <option value="Published">Published</option>
                        <option value="Unpublished">Unpublished</option>
                    </select>
                </div>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="articleTitle" class="form-label fw-bold">Title:</label>
                    <input type="text" id="articleTitle" class="form-control" [(ngModel)]="manuscript.title">
                </div>
                <div class="mb-3">
                    <label for="articleKeywords" class="form-label fw-bold">Keywords (comma-separated):</label>
                    <textarea id="articleKeywords" class="form-control" rows="2" [(ngModel)]="keywordsString"></textarea>
                </div>
                <div class="mb-3">
                    <label for="articleAbstract" class="form-label fw-bold">Abstract:</label>
                    <textarea id="articleAbstract" class="form-control" rows="6" [(ngModel)]="manuscript.abstract"></textarea>
                </div>
                <div class="mb-3">
                    <label for="articleDoi" class="form-label fw-bold">DOI:</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="bi bi-link-45deg"></i></span>
                        <input type="text" id="articleDoi" class="form-control" [(ngModel)]="manuscript.doi" placeholder="e.g., 10.1234/journal.2025.12345">
                        <a *ngIf="manuscript.doi" [href]="'https://doi.org/' + manuscript.doi" target="_blank" class="btn btn-outline-secondary" type="button">View DOI</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-people me-2"></i>Author Information
                </h5>
                <button class="btn btn-sm btn-outline-primary" (click)="addAuthor()">
                    <i class="bi bi-person-plus"></i> Add Author
                </button>
            </div>
            <div class="card-body">
                <div *ngIf="!manuscript.authors || manuscript.authors.length === 0" class="alert alert-info text-center" role="alert">
                    No author information available. Click "Add Author" to add one.
                </div>
                <div *ngFor="let author of manuscript.authors; let i = index" class="border rounded p-3 mb-3 bg-light">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0">Author {{ i + 1 }}</h6>
                        <button class="btn btn-sm btn-outline-danger" (click)="removeAuthor(i)">
                            <i class="bi bi-trash"></i> Remove
                        </button>
                    </div>
                    <div class="mb-2">
                        <label for="authorName{{i}}" class="form-label small mb-0">Name:</label>
                        <input type="text" id="authorName{{i}}" class="form-control form-control-sm" [(ngModel)]="author.name">
                    </div>
                    <div class="mb-2">
                        <label for="authorAffiliation{{i}}" class="form-label small mb-0">Affiliation:</label>
                        <input type="text" id="authorAffiliation{{i}}" class="form-control form-control-sm" [(ngModel)]="author.affiliation">
                    </div>
                    <div class="mb-2">
                        <label for="authorEmail{{i}}" class="form-label small mb-0">Email:</label>
                        <input type="email" id="authorEmail{{i}}" class="form-control form-control-sm" [(ngModel)]="author.email">
                    </div>
                    <div>
                        <label for="authorOrcid{{i}}" class="form-label small mb-0">ORCID (optional):</label>
                        <input type="text" id="authorOrcid{{i}}" class="form-control form-control-sm" [(ngModel)]="author.orcid" placeholder="e.g., 0000-0001-2345-6789">
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-file-earmark-text me-2"></i>Article File
                </h5>
                <div>
                    <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#uploadArticleFileModal">Upload/Replace File</button>
                </div>
            </div>
            <div class="card-body">
                <div *ngIf="manuscript.articleFile" class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="fw-semibold">{{ manuscript.articleFile.name }}</div>
                        <small class="text-muted">{{ (manuscript.articleFile.size / 1024).toFixed(2) }} KB</small>
                    </div>
                    <button type="button" class="btn btn-sm btn-primary"
                        (click)="downloadFile(manuscript.articleFile.url, manuscript.articleFile.name)">
                        <i class="bi bi-download"></i> Download Article
                    </button>
                </div>
                <div *ngIf="!manuscript.articleFile" class="text-muted">
                    No final article file uploaded yet.
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="bi bi-calendar-event me-2"></i>Publication Issue
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="journalSelect" class="form-label">Journal</label>
                        <select id="journalSelect" class="form-select" [(ngModel)]="selectedJournalId" (change)="onJournalChange()">
                            <option [ngValue]="null" disabled>Select Journal</option>
                            <option *ngFor="let journal of journals" [ngValue]="journal.id">{{ journal.name }}</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="volumeSelect" class="form-label">Volume</label>
                        <select id="volumeSelect" class="form-select" [(ngModel)]="selectedVolumeId" [disabled]="!selectedJournalId" (change)="onVolumeChange()">
                            <option [ngValue]="null" disabled>Select Volume</option>
                            <option *ngFor="let volume of filteredVolumes" [ngValue]="volume.id">{{ volume.number }} ({{ volume.year }})</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="issueSelect" class="form-label">Issue</label>
                        <select id="issueSelect" class="form-select" [(ngModel)]="selectedIssueId" [disabled]="!selectedVolumeId">
                            <option [ngValue]="null" disabled>Select Issue</option>
                            <option *ngFor="let issue of filteredIssues" [ngValue]="issue.id">{{ issue.number }} ({{ issue.title }})</option>
                        </select>
                    </div>
                </div>
                <div class="d-flex justify-content-end mt-3">
                    <button class="btn btn-primary" (click)="assignIssue()"
                        [disabled]="!selectedJournalId || !selectedVolumeId || !selectedIssueId">
                        Assign Issue
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="bi bi-journal-text me-2"></i>Publication Control
                </h5>
            </div>
            <div class="card-body d-flex flex-column gap-2">
                <button class="btn btn-success" style="font-size: 14px;" (click)="openPublicationActionModal('publishArticle')">
                    <i class="bi bi-cloud-arrow-up me-1"></i> Publish Article
                </button>
                <button class="btn btn-warning" style="font-size: 14px;" (click)="openPublicationActionModal('schedulePublication')">
                    <i class="bi bi-calendar-plus me-1"></i> Schedule Publication
                </button>
                <button class="btn btn-danger" style="font-size: 14px;" (click)="openPublicationActionModal('unpublishArticle')">
                    <i class="bi bi-cloud-arrow-down me-1"></i> Unpublish Article
                </button>
                <hr>
                <button class="btn btn-outline-secondary" style="font-size: 14px;" (click)="openPublicationActionModal('requestCorrections')">
                    <i class="bi bi-pencil-square me-1"></i> Request Corrections
                </button>
            </div>
        </div>

        <div class="d-grid gap-2">
            <button class="btn btn-dark btn-lg mt-3" (click)="saveAllChanges()">
                <i class="bi bi-save me-2"></i>Save All Changes
            </button>
        </div>
    </div>
</div>

<div class="modal fade" id="uploadArticleFileModal" tabindex="-1" aria-labelledby="uploadArticleFileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uploadArticleFileModalLabel">Upload Final Article File</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="articleFile" class="form-label">Select your final article file (e.g., PDF)</label>
                    <input class="form-control" type="file" id="articleFile" (change)="onArticleFileSelected($event)">
                </div>
                <div *ngIf="selectedArticleFile">
                    Selected file: {{ selectedArticleFile.name }} ({{ (selectedArticleFile.size / 1024).toFixed(2) }} KB)
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" (click)="uploadArticleFile()" [disabled]="!selectedArticleFile">Upload Article</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="publicationConfirmationModal" tabindex="-1" aria-labelledby="publicationConfirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="publicationConfirmationModalLabel">Confirm Publication Action</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>{{ confirmationMessage }}</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" (click)="confirmPublicationAction()">Confirm</button>
            </div>
        </div>
    </div>
</div>